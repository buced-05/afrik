{% extends "admin/base_site.html" %}
{% load static i18n admin_urls admin_modify %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* Page Header pour formulaires */
    .form-page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 32px 40px;
        margin: -32px -32px 32px -32px;
        color: white;
        border-radius: 0;
        position: relative;
        overflow: hidden;
    }
    
    .form-page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }
    
    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    .form-page-title {
        font-size: 2rem;
        font-weight: 900;
        color: white;
        margin: 0 0 8px 0;
        letter-spacing: -0.02em;
        text-shadow: 0 4px 8px rgba(0,0,0,0.2);
        position: relative;
        z-index: 1;
    }
    
    .form-page-subtitle {
        color: rgba(255,255,255,0.95);
        font-size: 1rem;
        margin: 0;
        font-weight: 400;
        position: relative;
        z-index: 1;
    }
    
    /* Form Container - Largeur optimale pour la lisibilité */
    #content {
        max-width: 1200px !important;
        margin: 0 auto !important;
        padding: 32px !important;
    }
    
    #content-main {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 40px 48px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        margin-bottom: 32px;
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Fieldsets améliorés */
    fieldset {
        background: var(--bg-secondary) !important;
        border: 2px solid var(--border-color) !important;
        border-radius: 20px !important;
        padding: 32px 40px !important;
        margin: 24px 0 !important;
        box-shadow: var(--shadow-sm) !important;
        transition: var(--transition) !important;
        position: relative;
        overflow: hidden;
    }
    
    fieldset::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-1);
        opacity: 0;
        transition: var(--transition);
    }
    
    fieldset:hover::before {
        opacity: 1;
    }
    
    fieldset:hover {
        border-color: var(--primary) !important;
        box-shadow: var(--shadow-md) !important;
        transform: translateY(-2px);
    }
    
    fieldset legend {
        background: var(--gradient-1) !important;
        color: white !important;
        padding: 12px 24px !important;
        border-radius: 12px !important;
        font-weight: 700 !important;
        font-size: 0.9375rem !important;
        text-transform: uppercase !important;
        letter-spacing: 0.08em !important;
        border: none !important;
        box-shadow: var(--shadow-sm) !important;
        position: relative;
        z-index: 1;
    }
    
    /* Form Rows améliorés - Layout optimisé pour la lisibilité */
    .form-row {
        display: flex;
        flex-direction: column;
        margin-bottom: 24px !important;
        transition: var(--transition) !important;
        position: relative;
        padding: 0 !important;
        background: transparent !important;
        border: none !important;
    }
    
    /* Les champs avec textarea prennent toute la largeur */
    .form-row:has(textarea) {
        width: 100%;
    }
    
    /* Groupement de champs courts sur deux colonnes si possible */
    .aligned .form-row:not(:has(textarea)) {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
    }
    
    .form-row:hover {
        border-color: var(--primary) !important;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1) !important;
        transform: translateX(4px);
    }
    
    .form-row label {
        font-weight: 600 !important;
        color: var(--text-primary) !important;
        margin-bottom: 10px !important;
        display: block !important;
        font-size: 0.875rem !important;
        text-transform: none !important;
        letter-spacing: 0.02em !important;
        position: relative;
        padding: 0;
    }
    
    .form-row label::before {
        content: '';
        position: absolute;
        left: -16px;
        top: 50%;
        transform: translateY(-50%);
        width: 3px;
        height: 16px;
        background: var(--primary);
        border-radius: 2px;
        opacity: 0.6;
    }
    
    /* Inputs améliorés */
    .form-row input[type=text],
    .form-row input[type=password],
    .form-row input[type=email],
    .form-row input[type=url],
    .form-row input[type=number],
    .form-row input[type=date],
    .form-row input[type=time],
    .form-row textarea,
    .form-row select,
    .form-row input[type=file] {
        width: 100% !important;
        border: 2px solid var(--border-color) !important;
        border-radius: 12px !important;
        padding: 12px 16px !important;
        background: var(--bg-card) !important;
        color: var(--text-primary) !important;
        font-size: 0.9375rem !important;
        font-weight: 400 !important;
        transition: var(--transition) !important;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05) !important;
    }
    
    .form-row input[type=text]:focus,
    .form-row input[type=password]:focus,
    .form-row input[type=email]:focus,
    .form-row input[type=url]:focus,
    .form-row input[type=number]:focus,
    .form-row input[type=date]:focus,
    .form-row input[type=time]:focus,
    .form-row textarea:focus,
    .form-row select:focus {
        border-color: var(--primary) !important;
        outline: none !important;
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15), var(--shadow-md) !important;
        transform: translateY(-1px);
    }
    
    .form-row textarea {
        min-height: 120px !important;
        resize: vertical !important;
        font-family: inherit !important;
        line-height: 1.6 !important;
    }
    
    /* Champs de description prennent plus de hauteur */
    textarea[name="description"] {
        min-height: 180px !important;
    }
    
    .form-row select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 14 14'%3E%3Cpath fill='%232563eb' d='M7 10L2 5h10z'/%3E%3C/svg%3E") !important;
        background-repeat: no-repeat !important;
        background-position: right 16px center !important;
        padding-right: 45px !important;
        appearance: none !important;
        cursor: pointer !important;
    }
    
    /* Help Text */
    .help,
    .helptext {
        color: var(--text-secondary) !important;
        font-size: 0.875rem !important;
        margin-top: 8px !important;
        padding: 12px 16px !important;
        background: var(--bg-primary) !important;
        border-radius: 10px !important;
        border-left: 4px solid var(--info) !important;
        display: block !important;
        font-weight: 500 !important;
        line-height: 1.5 !important;
    }
    
    /* Required indicator */
    .required {
        color: var(--danger) !important;
        font-weight: 700 !important;
        margin-left: 4px !important;
        font-size: 1.1em !important;
    }
    
    /* Errors */
    .errornote {
        background: rgba(239, 68, 68, 0.1) !important;
        border: 2px solid var(--danger) !important;
        color: #dc2626 !important;
        padding: 16px 20px !important;
        border-radius: 12px !important;
        margin-bottom: 24px !important;
        font-weight: 600 !important;
        border-left: 6px solid var(--danger) !important;
    }
    
    .errorlist {
        background: rgba(239, 68, 68, 0.1) !important;
        border: 2px solid var(--danger) !important;
        color: #dc2626 !important;
        padding: 12px 16px !important;
        border-radius: 10px !important;
        margin-top: 8px !important;
        margin-bottom: 0 !important;
        list-style: none !important;
        font-weight: 500 !important;
    }
    
    .errorlist li {
        padding: 4px 0 !important;
    }
    
    .errorlist li::before {
        content: '⚠ ';
        font-weight: 700;
    }
    
    /* Readonly fields */
    .readonly {
        background: var(--bg-primary) !important;
        padding: 16px 20px !important;
        border-radius: 12px !important;
        border-left: 4px solid var(--info) !important;
        color: var(--text-secondary) !important;
        font-weight: 500 !important;
    }
    
    /* Checkboxes et Radio buttons */
    input[type=checkbox],
    input[type=radio] {
        width: 20px !important;
        height: 20px !important;
        cursor: pointer !important;
        accent-color: var(--primary) !important;
    }
    
    /* Submit Row amélioré */
    .submit-row {
        background: var(--bg-secondary) !important;
        padding: 28px 32px !important;
        border-radius: 20px !important;
        margin-top: 40px !important;
        border: 2px solid var(--border-color) !important;
        display: flex !important;
        gap: 16px !important;
        align-items: center !important;
        flex-wrap: wrap !important;
        box-shadow: var(--shadow-md) !important;
    }
    
    .submit-row input[type=submit],
    .submit-row input[type=button] {
        padding: 14px 28px !important;
        border-radius: 12px !important;
        font-weight: 700 !important;
        font-size: 0.9375rem !important;
        text-transform: uppercase !important;
        letter-spacing: 0.05em !important;
        transition: var(--transition) !important;
        cursor: pointer !important;
        border: none !important;
    }
    
    .submit-row input[type=submit].default {
        background: var(--gradient-1) !important;
        color: white !important;
        box-shadow: var(--shadow-md) !important;
    }
    
    .submit-row input[type=submit].default:hover {
        transform: translateY(-2px) !important;
        box-shadow: var(--shadow-lg) !important;
    }
    
    .submit-row input[type=button] {
        background: var(--bg-card) !important;
        color: var(--text-primary) !important;
        border: 2px solid var(--border-color) !important;
    }
    
    .submit-row input[type=button]:hover {
        border-color: var(--primary) !important;
        color: var(--primary) !important;
        background: rgba(37, 99, 235, 0.05) !important;
    }
    
    .submit-row .deletelink {
        background: var(--danger) !important;
        color: white !important;
        padding: 14px 28px !important;
        border-radius: 12px !important;
        font-weight: 700 !important;
        text-transform: uppercase !important;
        letter-spacing: 0.05em !important;
        text-decoration: none !important;
        display: inline-block !important;
        transition: var(--transition) !important;
    }
    
    .submit-row .deletelink:hover {
        background: #dc2626 !important;
        transform: translateY(-2px) !important;
        box-shadow: var(--shadow-lg) !important;
        color: white !important;
    }
    
    /* Object Tools */
    .object-tools {
        margin-bottom: 24px !important;
    }
    
    .object-tools li {
        list-style: none !important;
        margin: 0 !important;
    }
    
    .object-tools a {
        background: var(--gradient-1) !important;
        padding: 12px 24px !important;
        border-radius: 12px !important;
        color: white !important;
        font-weight: 600 !important;
        text-decoration: none !important;
        transition: var(--transition) !important;
        display: inline-flex !important;
        align-items: center !important;
        gap: 8px !important;
    }
    
    .object-tools a:hover {
        transform: translateY(-2px) !important;
        box-shadow: var(--shadow-lg) !important;
        color: white !important;
    }
    
    /* Inline Forms */
    .inline-group {
        background: var(--bg-card) !important;
        border-radius: 20px !important;
        padding: 24px !important;
        margin: 24px 0 !important;
        border: 2px solid var(--border-color) !important;
    }
    
    .inline-group h2 {
        background: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
        padding: 16px 20px !important;
        border-radius: 12px !important;
        margin: -24px -24px 20px -24px !important;
        font-weight: 700 !important;
        text-transform: uppercase !important;
        letter-spacing: 0.05em !important;
    }
    
    /* File upload */
    .file-upload {
        border: 2px dashed var(--border-color) !important;
        border-radius: 12px !important;
        padding: 32px !important;
        text-align: center !important;
        transition: var(--transition) !important;
        background: var(--bg-primary) !important;
    }
    
    .file-upload:hover {
        border-color: var(--primary) !important;
        background: rgba(37, 99, 235, 0.05) !important;
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
        #content-main {
            max-width: 100% !important;
            padding: 32px !important;
        }
        
        .aligned .form-row {
            grid-template-columns: 1fr !important;
            gap: 20px;
        }
    }
    
    @media (max-width: 768px) {
        #content {
            padding: 20px !important;
        }
        
        #content-main {
            padding: 24px !important;
        }
        
        fieldset {
            padding: 24px !important;
        }
        
        .form-row {
            margin-bottom: 20px !important;
        }
        
        .form-page-header {
            padding: 24px !important;
        }
        
        .form-page-title {
            font-size: 1.5rem !important;
        }
    }
</style>
{% endblock %}

{% block extrahead %}{{ block.super }}
<script src="{% url 'admin:jsi18n' %}"></script>
{{ media }}
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% if not is_popup %}
{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; {% if has_view_permission %}<a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>{% else %}{{ opts.verbose_name_plural|capfirst }}{% endif %}
&rsaquo; {% if add %}{% blocktranslate with name=opts.verbose_name %}Add {{ name }}{% endblocktranslate %}{% else %}{{ original|truncatewords:"18" }}{% endif %}
</div>
{% endblock %}
{% endif %}

{% block content %}
<div class="form-page-header">
    <h1 class="form-page-title">
        {% if add %}
            {% blocktranslate with name=opts.verbose_name %}➕ Ajouter {{ name }}{% endblocktranslate %}
        {% else %}
            ✏️ {{ original|truncatewords:"18" }}
        {% endif %}
    </h1>
    <p class="form-page-subtitle">
        {% if add %}
            Remplissez le formulaire ci-dessous pour ajouter un nouvel élément
        {% else %}
            Modifiez les informations de cet élément
        {% endif %}
    </p>
</div>

<div id="content-main">
{% block object-tools %}
{% if change and not is_popup %}
  <ul class="object-tools">
    {% block object-tools-items %}
      {% change_form_object_tools %}
    {% endblock %}
  </ul>
{% endif %}
{% endblock %}

<form {% if has_file_field %}enctype="multipart/form-data" {% endif %}{% if form_url %}action="{{ form_url }}" {% endif %}method="post" id="{{ opts.model_name }}_form" novalidate>{% csrf_token %}{% block form_top %}{% endblock %}
<div>
{% if is_popup %}<input type="hidden" name="{{ is_popup_var }}" value="1">{% endif %}
{% if to_field %}<input type="hidden" name="{{ to_field_var }}" value="{{ to_field }}">{% endif %}
{% if save_on_top %}{% block submit_buttons_top %}{% submit_row %}{% endblock %}{% endif %}
{% if errors %}
    <p class="errornote">
    {% blocktranslate count counter=errors|length %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktranslate %}
    </p>
    {{ adminform.form.non_field_errors }}
{% endif %}

{% block field_sets %}
{% for fieldset in adminform %}
  {% include "admin/includes/fieldset.html" %}
{% endfor %}
{% endblock %}

{% block after_field_sets %}{% endblock %}

{% block inline_field_sets %}
{% for inline_admin_formset in inline_admin_formsets %}
    {% include inline_admin_formset.opts.template %}
{% endfor %}
{% endblock %}

{% block after_related_objects %}{% endblock %}

{% block submit_buttons_bottom %}{% submit_row %}{% endblock %}

{% block admin_change_form_document_ready %}
    <script id="django-admin-form-add-constants"
            src="{% static 'admin/js/change_form.js' %}"
            {% if adminform and add %}
                data-model-name="{{ opts.model_name }}"
            {% endif %}
            async>
    </script>
{% endblock %}

{# JavaScript for prepopulated fields #}
{% prepopulated_fields_js %}

</div>
</form></div>
{% endblock %}

